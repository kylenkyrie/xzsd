<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.pc.CarouselFigure.dao.CarouselFigureDao">

    <!--统计序号数量-->
    <select id="countSortId" parameterType="com.xzsd.pc.CarouselFigure.dao.CarouselFigureDao" resultType="int">
        select count(sort_id)
        from t_sys_carousel_figure
        where is_deleted = 0
        and sort_id = #{sortId}
        <if test="pictureId != null and pictureId != ''">
            and picture_id != #{pictureId}
        </if>
    </select>

    <!--新增图片-->
    <insert id="addPicture" parameterType="com.xzsd.pc.CarouselFigure.entity.CarouselFigureInfo">
        insert into t_sys_carousel_figure
        (
        picture_id,
        sort_id,
        picture_path,
        time_start,
        time_end,
        goods_id,
        goods_name,
        picture_status,
        is_deleted,
        gmt_create,
        create_by,
        gmt_modified,
        last_modified_by,
        version
        )
        values
           (#{pictureId},
            #{sortId},
            #{picturePath},
            #{timeStart},
            #{timeEnd},
            #{goodsId},
            #{goodsName},
            1,
            #{isDeleted},
            now(),
            #{createBy},
            now(),
            #{lastModifiedBy},
            0)
    </insert>

    <!--获取轮播图所有信息-->
    <select id="listPictureByPage" parameterType="com.xzsd.pc.CarouselFigure.entity.CarouselFigureInfo" resultType="com.xzsd.pc.CarouselFigure.entity.CarouselFigureInfo">
        select
        sort_id sortId,
        picture_path picturePath,
        time_start timeStart,
        time_end timeEnd,
        picture_status pictureStatus
        FROM
        t_sys_carousel_figure
        where
        is_deleted = 0
        <if test="pictureStatus != null">
            and picture_status = #{pictureStatus}
        </if>
        order by sort_id asc
    </select>

    <!--获取商品所有信息-->
    <select id="listGoodsByPage" parameterType="com.xzsd.pc.goods.entity.GoodsInfo" resultType="com.xzsd.pc.goods.entity.GoodsInfo">
        select
        goods_id goodsId,
        goods_name goodsName,
        class_one classOne,
        class_two classTwo,
        goods_status
        FROM
        t_sys_goodsinfo
        where
        is_deleted = 0
        and
        goods_status = 1
        <if test="goodsName != null and goodsName != ''">
            and goods_name like concat('%', #{goodsName}, '%')
        </if>
        <if test="goodsId != null and goodsId != ''">
            and goods_id like concat('%', #{goodsId}, '%')
        </if>
        and
        goods_id not in (select goods_id from t_sys_carousel_figure)
    </select>

    <!--修改轮播图状态-->
    <update id = "updatePictureStatus" parameterType="com.xzsd.pc.CarouselFigure.entity.CarouselFigureInfo">
        update
        t_sys_carousel_figure
        set
        picture_status = #{pictureStatus},
        gmt_modified = now(),
        last_modified_by = #{lastModifiedBy},
        version = version + 1
        where
        picture_id = #{pictureId}
        and
        version = #{version}
    </update>

    <!--删除商品-->
    <update id = "deletePicture" parameterType="com.xzsd.pc.CarouselFigure.entity.CarouselFigureInfo">
        update
        t_sys_carousel_figure
        set
        is_deleted = 1,
        gmt_modified = now(),
        last_modified_by = #{userCode},
        version = version + 1
        where picture_id in
        <foreach item="item" index="index" collection="listCode" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
</mapper>